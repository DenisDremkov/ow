<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">
</head>

<body ng-app="ow">

	<header>
		
		<div 
			ng-controller 	= "authCtrl"
			id				= "auth">
			
			<!-- all users -->
			<div id="allUsers">
				
				<button  
					ng-click= "getAllUsersList()"
					class	= "btn btn-light">
					get all users list
				</button>
				
				<ul>
					<li ng-repeat="user in allUsersList">{{user.username}}, </li>
				</ul>
			</div>
			
			<!-- sign in -->
			<span 
				id		 = "sign-in-handler" 
				ng-if 	 = "!isLogged()"
				ng-click = "toggleLoginForm()"
				class    = "glyphicon glyphicon-log-in">
			</span>
			
			<!-- hello -->
			<span 
				id		= "hello" 
				ng-if	= "isLogged()">
				Hello, {{getUserName()}}
			</span>
			
			<!-- sign-out -->
			<span 
				id		 = "sign-out-handler" 
				ng-if 	 = "isLogged()"
				ng-click = "signOut()"
				class    = "glyphicon glyphicon-log-out">
			</span>
			
			<!-- login form -->
			<div 
				ng-if 			= "view.login"
				ng-controller 	= "loginCtrl"
				id				= "login"
				class			= "auth-form">
				
				<input 
					ng-model	= "user.username" 
					type		= "text"
					class		= "form-control"
					placeholder = "username">
				
				<input 
					ng-model	= "user.password" 
					type		= "password" 
					class		= "form-control"
					placeholder = "password">
				
				<button 
					class	= "btn btn-success"
					ng-click= "login()">
					login
				</button>

				<button 
					class	= "btn btn-light"
					ng-click= "hideLoginForm()">
					cancel
				</button>
				<span 
					id			= "err-msg" 
					ng-class	= "errMsg.class">
					{{errMsg.registrErrMsg}}
				</span>
				<a ng-click = "openRegistrForm()">registration</a>
			</div>
			
			<!-- registr form -->
			<div 
				ng-if 			= "view.registr"
				ng-controller 	= "registrCtrl"
				id				= "registr"
				class			= "auth-form">
				
				<input 
					ng-model	= "newUser.username" 
					type		= "text"
					class		= "form-control"
					placeholder = "username">
				
				<input 
					ng-model	= "newUser.password" 
					type		= "password" 
					class		= "form-control"
					placeholder = "password">
				
				<input 
					ng-model	= "newUser.confirm"
					type		= "password"
					class		= "form-control" 
					placeholder = "confirm password">
				
				<button
					class	= "btn btn-success"
					ng-click = "registr()">
					registr
				</button>
				<button
					ng-click = "hideRegistrForm()"
					class	= "btn btn-light">
					cancel
				</button>
				<span 
					id			= "err-msg" 
					ng-class	= "errMsg.class">
					{{errMsg.registrErrMsg}}
				</span>
			</div>
		</div>	
	</header>

	<main ng-controller= "dataCtrl">
		
		<!-- request -->
		<div id="request-block">
			
			<input 
				class		= "form-control"  
				ng-model	= "city" 
				type		= "text"
				placeholder	= "enter city"
				aucomplete>
			
			<!-- add to favorite btn -->
			<button 
				ng-if		= "isLogged()"
				ng-click	= "addToFavorite()"
				class 		= "btn btn-success"
				ng-disabled = "disableAddBtn()">
				add to favorites
			</button>

			<!-- get button -->
			<button 
				ng-click= "getCityData(city)" 
				class	= "btn btn-primary" ng-disabled = "disableGetBtn()">
				get weather
			</button>
		</div>
		
		<!-- response -->
		<div id="response-block">
			
			<!-- favorite -->
			<div
				ng-if 			= "isLogged()"
				ng-controller	= "favoriteCtrl" 
				id				= "favorite">
				
				<h3>favorite city: </h3>
				
				<ul>
					
					<li ng-repeat = "city in favorites">
						
						<button 
							class	= "btn btn-light" 
							ng-click= "getCityData(city)">
							{{city}}
						</button>
						
						<span 
							ng-click= "deleteFavoriteCity(city)" 
							class	= "glyphicon glyphicon-trash">
						</span>
					</li>
				</ul>
			</div>
			
			<!-- main view -->
			<table 
				ng-if 	= "mainView" 
				class 	= "table table-bordered" 
				id		="main-view-table">
				
				<tr><td><h2>{{mainView.name}}</h2></td></tr>
				
				<tr ng-repeat="(key, value) in mainView">
					
					<td>{{key}}</td>
					
					<td ng-if = "detectDataType(value) === 'simple'">{{value}}</td> 
					
					<td ng-if = "detectDataType(value) === 'object'">
						
						<table class = "table table-bordered">
							
							<tr ng-repeat = "(key, value) in value">
								
								<td>{{key}}</td>
								<td>{{value}}</td>
							</tr>
						</table>
					</td> 
					
					<td ng-if = "detectDataType(value) === 'array'">
						
						<ul>
							
							<li ng-repeat = "item in value">
								
								<span ng-if = "detectDataType(value) === 'simple'">{{item}}</span>
								
								<table 
									ng-if = "detectDataType(item) === 'object'" 
									class = "table table-bordered">
									
									<tr ng-repeat = "(key, value) in item">
										<td>{{key}}</td>
										<td>{{value}}</td>
									</tr>
								</table>
							</li>
						</ul>
					</td> 
				</tr>
			</table>
		</div>
	</main>

	<footer>

	</footer>

	<!-- scripts -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-cookies.js"></script>
	<script src="index.js"></script>	
</body>
</html>
